webpackJsonp([4],{"2bqU":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={name:"createForm",components:{ItemDetail:o("Vv3Z").a}},i={render:function(){var t=this.$createElement;return(this._self._c||t)("item-detail",{attrs:{"is-edit":!1}})},staticRenderFns:[]},a=o("VU/8")(s,i,!1,null,null,null);e.default=a.exports},N2hj:function(t,e,o){var s=o("o773");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);o("rjj0")("102d11aa",s,!0)},Vv3Z:function(t,e,o){"use strict";var s=o("BO1k"),i=o.n(s),a=o("mvHQ"),r=o.n(a),n=o("woOf"),l=o.n(n),c=(o("mw3O"),o("YVAe")),d=o("D4dz"),m=o("eqaL"),p=o("vHhr"),u=o("MSnT"),g=o("0xDb"),h=[{key:1,name:"淘宝"},{key:2,name:"京东"},{key:3,name:"拼多多"}],f=(h.reduce(function(t,e){return t[e.key]=e.name,t},{}),[{key:0,name:"本地商品详情"},{key:1,name:"淘宝商品详情"},{key:2,name:"京东商品详情"},{key:3,name:"拼多多商品详情"}]),b=(f.reduce(function(t,e){return t[e.key]=e.name,t},{}),{id:void 0,publish_time:null,commits:"",content:"",share_user_id:null,user:{name:"",img:null},goods:[]}),v={id:void 0,data_id:"",share_sales_id:0,jump_type:1,type:1,content:"",open_data:null,imgs:[]},_={name:"",img:null},y={name:"itemDetail",components:{Tinymce:c.a,Mupload:d.a,Upload:m.a,Sticky:p.a},props:{isEdit:{type:Boolean,default:!1}},data:function(){return{postForm:l()({},b),goodsForm:l()({},v),userForm:l()({},_),loading:!1,typeOptions:h,jumpOptions:f,outerVisible:!1,innerVisible:!1,dialogFormVisible:!1,dialogStatus:"",goodsTips:"",textMap:{update:"编辑商品",create:"创建商品"},users:[],rules:{publish_time:[{required:!0,message:"请输入发布时间",trigger:"blur"}],commits:[{required:!0,message:"请输入评论",trigger:"blur"}],content:[{required:!0,message:"请输入描述",trigger:"blur"}],share_user_id:[{required:!0,message:"请选择发布人",trigger:"blur"}],goods:[{type:"array",required:!0,message:"上传的商品必须在1-9个之间",min:1,max:9,trigger:"change"}]},goodsRules:{data_id:[{required:!0,message:"请输入商品ID",trigger:"blur"}],type:[{required:!0,message:"请输入商品类型",trigger:"change"}],jump_type:[{required:!0,message:"请输入跳转类型",trigger:"change"}],imgs:[{type:"array",required:!0,message:"上传的图片必须在1-3张之间",min:1,max:3,trigger:"change"}]}}},created:function(){if(this.isEdit){var t=this.$route.params&&this.$route.params.id;this.fetchData(t)}else this.postForm=l()({},b),this.postForm.goods=[];this.getUserList()},methods:{fetchData:function(t){var e=this;this.loading=!0,Object(u.d)(t).then(function(t){e.postForm=t.data.data,e.postForm.publish_time=Object(g.f)(e.postForm.publish_time);for(var o=e.postForm.goods.length-1;o>=0;o--)e.postForm.goods[o].imgs=JSON.parse(e.postForm.goods[o].imgs),e.postForm.goods[o].open_data=JSON.parse(e.postForm.goods[o].open_data);e.loading=!1}).catch(function(t){console.log(t)})},getUserList:function(){var t=this;this.loading=!0,Object(u.g)().then(function(e){t.users=e.data.data,t.loading=!1})},handleUser:function(){this.userForm=l()({},_),this.innerVisible=!0},createUser:function(){var t=this;Object(u.b)(this.userForm).then(function(e){200==e.data.code?(t.users.unshift(e.data.data),t.innerVisible=!1):t.$message({message:e.data.msg,type:"warning"})})},deleteUser:function(t){var e=this;Object(u.c)(t.id).then(function(o){if(200==o.data.code){e.$message({type:"success",message:o.data.data});var s=e.users.indexOf(t);e.users.splice(s,1)}else e.$message({type:"error",message:o.data.msg})})},checkUser:function(t){this.postForm.share_user_id=t.id,this.postForm.user=t,this.outerVisible=!1},submitForm:function(){var t=this;this.$refs.postForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;var o=t.resetData();t.isEdit?(t.loading=!0,Object(u.i)(o,t.postForm.id).then(function(e){200==e.data.code?t.$message({type:"success",message:e.data.data}):t.$message({type:"error",message:e.data.msg}),t.loading=!1})):(t.loading=!0,Object(u.a)(o).then(function(e){200==e.data.code?(t.$message({type:"success",message:e.data.data}),Object(u.h)(),t.$router.push("/community/share_sales")):t.$message({type:"error",message:e.data.msg}),t.loading=!1}))})},resetData:function(){return{publish_time:Object(g.e)(this.postForm.publish_time),commits:this.postForm.commits,content:this.postForm.content,share_user_id:this.postForm.share_user_id,goods:r()(this.postForm.goods)}},checkOpen:function(){var t=this;1!=this.checkDataId()&&Object(u.e)(this.goodsForm.type,this.goodsForm.data_id).then(function(e){200==e.data.code?(t.goodsForm.content=e.data.data.title,t.goodsForm.open_data=e.data.data,t.innerVisible=!1):t.goodsTips=e.data.msg})},handleCreate:function(){var t=this;this.goodsForm=l()({},v),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.goodsForm.clearValidate()})},createData:function(){var t=this;this.postForm.goods.length>9&&(this.$message("最多只能上传9个商品"),this.dialogFormVisible=!1),1!=this.checkDataId()&&this.$refs.goodsForm.validate(function(e){e&&(t.postForm.goods.push(t.goodsForm),t.dialogFormVisible=!1)})},handleUpdate:function(t){var e=this;this.goodsForm=l()({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.goodsForm.clearValidate()})},updateData:function(){var t=this;1!=this.checkDataId()&&this.$refs.goodsForm.validate(function(e){if(e){var o=!0,s=!1,a=void 0;try{for(var r,n=i()(t.postForm.goods);!(o=(r=n.next()).done);o=!0){var l=r.value;if(l.data_id===t.goodsForm.data_id){var c=t.postForm.goods.indexOf(l);t.postForm.goods.splice(c,1,t.goodsForm);break}}}catch(t){s=!0,a=t}finally{try{!o&&n.return&&n.return()}finally{if(s)throw a}}t.dialogFormVisible=!1}})},deleteData:function(t){var e=this.postForm.goods.indexOf(t);this.postForm.goods.splice(e,1)},checkDataId:function(){return""==this.goodsForm.data_id?(this.goodsTips="请输入商品ID",1):(this.goodsTips="",0)},imageSuccessCBK:function(t){this.goodsForm.imgs=t}}},F={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"createPost-container",attrs:{"element-loading-text":"处理中.."}},[o("el-form",{ref:"postForm",staticClass:"form-container",attrs:{model:t.postForm,size:"small",rules:t.rules}},[o("sticky",{attrs:{className:"sub-navbar draft"}},[o("router-link",{attrs:{to:"/community/share_sales"}},[o("el-button",{staticStyle:{margin:"10px","margin-bottom":"0"},attrs:{type:"text",icon:"el-icon-back"}},[t._v("返回列表")])],1)],1),t._v(" "),o("div",{staticClass:"createPost-main-container"},[o("el-form-item",{attrs:{label:"发布人昵称",prop:"share_user_id"}},[null!=t.postForm.user?o("span",[t._v(t._s(t.postForm.user.name))]):t._e(),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.outerVisible=!0}}},[t._v("选择发布人")])],1),t._v(" "),o("el-form-item",{attrs:{label:"发布人头像"}},[null!=t.postForm.user?o("img",{attrs:{src:t.postForm.user.img,width:"auto",height:"80"}}):t._e()]),t._v(" "),o("el-form-item",{attrs:{label:"发布时间",prop:"publish_time"}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:t.postForm.publish_time,callback:function(e){t.$set(t.postForm,"publish_time",e)},expression:"postForm.publish_time"}})],1),t._v(" "),o("el-form-item",{staticClass:"tinymini",attrs:{label:"内容描述",prop:"content"}},[o("br"),t._v(" "),o("Tinymce",{ref:"editor",attrs:{height:300},model:{value:t.postForm.content,callback:function(e){t.$set(t.postForm,"content",e)},expression:"postForm.content"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"精选评论",prop:"commits"}},[o("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:t.postForm.commits,callback:function(e){t.$set(t.postForm,"commits",e)},expression:"postForm.commits"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品列表",prop:"goods"}},[o("div",{staticClass:"list-goods"},[o("ul",t._l(t.postForm.goods,function(e,s){return o("li",{staticClass:"goods-item"},[o("el-col",{staticStyle:{"padding-right":"5px","text-align":"right","line-height":"70px",color:"#606266"},attrs:{span:2}},[o("b",[t._v("商品"+t._s(s+1))])]),t._v(" "),o("el-col",{staticStyle:{"padding-left":"5px","padding-right":"5px","padding-top":"15px"},attrs:{span:8}},[o("div",{staticStyle:{color:"gray"},domProps:{innerHTML:t._s(e.content)}})]),t._v(" "),o("el-col",{attrs:{span:8}},t._l(e.imgs,function(t){return o("img",{staticStyle:{float:"left","margin-left":"5px"},attrs:{src:t,width:"auto",height:"80"}})})),t._v(" "),o("el-col",{staticStyle:{"padding-top":"20px"},attrs:{span:6}},[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){t.handleUpdate(e)}}},[t._v("修改")]),t._v(" "),o("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(o){t.deleteData(e)}}},[t._v("删除")])],1),t._v(" "),o("div",{staticStyle:{clear:"both",width:"100%",height:"0"}})],1)}))])]),t._v(" "),o("div",{staticStyle:{clear:"both",width:"100%","margin-top":"1rem","margin-bottom":"1rem"}},[o("el-col",{attrs:{span:2}}),t._v(" "),o("el-col",{attrs:{span:20}},[o("el-button",{attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("添加商品")]),t._v(" "),o("el-button",{staticStyle:{"margin-left":"2rem"},on:{click:t.submitForm}},[t._v("发布爆款")])],1),t._v(" "),o("div",{staticStyle:{width:"100%",height:"0.5rem",clear:"both"}})],1)],1)],1),t._v(" "),o("el-dialog",{staticClass:"faburen",attrs:{title:"选择发布人",visible:t.outerVisible,width:"60%"},on:{"update:visible":function(e){t.outerVisible=e}}},[o("el-dialog",{attrs:{width:"30%",size:"small",title:"添加发布人",visible:t.innerVisible,"append-to-body":""},on:{"update:visible":function(e){t.innerVisible=e}}},[o("el-form",{attrs:{model:t.userForm}},[o("el-form-item",{attrs:{label:"发布人昵称"}},[o("el-col",{attrs:{span:8}},[o("el-input",{model:{value:t.userForm.name,callback:function(e){t.$set(t.userForm,"name",e)},expression:"userForm.name"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"图片上传"}},[o("div",{staticStyle:{"margin-bottom":"20px"}},[o("Upload",{model:{value:t.userForm.img,callback:function(e){t.$set(t.userForm,"img",e)},expression:"userForm.img"}})],1)])],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:t.createUser}},[t._v("确定")])],1)],1),t._v(" "),o("div",{staticClass:"list-user"},[o("ul",t._l(t.users,function(e){return o("li",{staticClass:"user-item"},[o("i",{staticClass:"el-icon-circle-check",attrs:{title:"点击选择该发布人"}}),t._v(" "),o("img",{attrs:{src:e.img,alt:"点击选择该发布人"},on:{click:function(o){t.checkUser(e)}}}),t._v(" "),o("h6",[t._v(t._s(e.name))]),t._v(" "),o("i",{staticClass:"el-icon-delete",attrs:{title:"删除该发布人"},on:{click:function(o){t.deleteUser(e)}}})])})),t._v(" "),o("div",{staticStyle:{width:"100%",height:"0.5rem",clear:"both"}})]),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.handleUser()}}},[t._v("添加发布人")])],1)],1),t._v(" "),o("el-dialog",{staticClass:"goods",attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"60%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[o("el-form",{ref:"goodsForm",attrs:{model:t.goodsForm,rules:t.goodsRules,size:"small"}},[o("el-form-item",{attrs:{label:"商品类别",prop:"type"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择商品类别"},model:{value:t.goodsForm.type,callback:function(e){t.$set(t.goodsForm,"type",e)},expression:"goodsForm.type"}},t._l(t.typeOptions,function(t){return o("el-option",{key:t.key,attrs:{label:t.name,value:t.key}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"跳转方式",prop:"jump_type"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择跳转方式"},model:{value:t.goodsForm.jump_type,callback:function(e){t.$set(t.goodsForm,"jump_type",e)},expression:"goodsForm.jump_type"}},t._l(t.jumpOptions,function(t){return o("el-option",{key:t.key,attrs:{label:t.name,value:t.key}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"商品ID",prop:"data_id"}},[o("el-col",{attrs:{span:8}},[o("el-input",{on:{blur:function(e){t.checkOpen()}},model:{value:t.goodsForm.data_id,callback:function(e){t.$set(t.goodsForm,"data_id",e)},expression:"goodsForm.data_id"}})],1),t._v(" "),o("span",{staticStyle:{color:"red","padding-left":"5px"}},[t._v(t._s(t.goodsTips))])],1),t._v(" "),o("el-form-item",{attrs:{label:"商品图片",prop:"imgs"}},[o("div",{staticStyle:{"margin-bottom":"20px"}},[o("Mupload",{attrs:{imgs:t.goodsForm.imgs},on:{successCBK:t.imageSuccessCBK}}),t._v(" "),o("span",{staticStyle:{color:"red"}},[t._v("[固定尺寸：宽540px*高540px，格式JPG，PNG]")])],1)])],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?o("el-button",{attrs:{type:"primary"},on:{click:t.createData}},[t._v("添加")]):o("el-button",{attrs:{type:"primary"},on:{click:t.updateData}},[t._v("更新")])],1)],1)],1)},staticRenderFns:[]};var x=o("VU/8")(y,F,!1,function(t){o("N2hj"),o("zPSi")},"data-v-4b0c74f2",null);e.a=x.exports},fR5u:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n.faburen .el-dialog__body{padding: 0\n}\n.goods .el-dialog__body{padding: 0 15px;\n}\n.list-user{\n  background: #F2F2F2;\n  width: 100%;\n  clear: both;\n  padding: 0 10px;\n}\n.list-user .user-item{\n  width: 15%;\n  margin-left: 0.83%;\n  margin-right: 0.83%;\n  margin-top: 0.5rem;\n  background: #fff;\n  float: left;\n}\n.list-user .user-item img{\n  width: 100%;\n  height: 7.5rem;\n  z-index: 1;\n}\n.list-user .user-item h6{\n  padding: 0;\n  margin:0;\n  text-align: center;\n}\n.list-user .user-item i{\n  display: none;\n  z-index: 2;\n}\n.list-user .user-item:hover i{\n  display: inline;\n}\n.list-user .user-item i.el-icon-circle-check{\n  color: green; position: absolute; margin-left: 12.5%; margin-bottom: -3rem; font-size: 18px;\n}\n.list-user .user-item i.el-icon-delete{\n  color: red; float: right; margin-top: -1rem;\n}\n.list-goods{\n  width: 100%;\n  clear: both;\n  padding: 0 10px;\n  border-top: 1px solid #eee;\n}\n.list-goods .goods-item{\n  border-bottom: 1px solid #eee;\n  width: 100%;\n  padding-bottom: 5px;\n  padding-top: 5px;\n  clear: both;\n}\n",""])},mvHQ:function(t,e,o){t.exports={default:o("qkKv"),__esModule:!0}},o773:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,'\n.createPost-container[data-v-4b0c74f2] {\n  position: relative;\n}\n.createPost-container .createPost-main-container[data-v-4b0c74f2] {\n    padding: 40px 45px 20px 50px;\n}\n.createPost-container .createPost-main-container .postInfo-container[data-v-4b0c74f2] {\n      position: relative;\n      margin-bottom: 10px;\n}\n.createPost-container .createPost-main-container .postInfo-container[data-v-4b0c74f2]:after {\n        content: "";\n        display: table;\n        clear: both;\n}\n.createPost-container .createPost-main-container .postInfo-container .postInfo-container-item[data-v-4b0c74f2] {\n        float: left;\n}\n.createPost-container .createPost-main-container .editor-container[data-v-4b0c74f2] {\n      min-height: 500px;\n      margin: 0 0 30px;\n}\n.createPost-container .createPost-main-container .editor-container .editor-upload-btn-container[data-v-4b0c74f2] {\n        text-align: right;\n        margin-right: 10px;\n}\n.createPost-container .createPost-main-container .editor-container .editor-upload-btn-container .editor-upload-btn[data-v-4b0c74f2] {\n          display: inline-block;\n}\n.createPost-container .word-counter[data-v-4b0c74f2] {\n    width: 40px;\n    position: absolute;\n    right: -10px;\n    top: 0px;\n}\n',""])},qkKv:function(t,e,o){var s=o("FeBl"),i=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},zPSi:function(t,e,o){var s=o("fR5u");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);o("rjj0")("86d18224",s,!0)}});