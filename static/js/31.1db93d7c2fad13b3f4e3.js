webpackJsonp([31],{OcTX:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l("BO1k"),i=l.n(a),r=l("woOf"),n=l.n(r),s=l("ZNHS"),o=l("y/Jw"),c=l("0xDb"),u=[{key:"order_code",name:"订单号"},{key:"title",name:"商品名"},{key:"product_code",name:"商品ID"},{key:"uname",name:"会员名"},{key:"uid",name:"会员id"}],m=[{key:1,name:"电脑"},{key:2,name:"手机"},{key:null,name:"全部"}],p=[{key:-1,name:"订单已失效"},{key:0,name:"订单未确认"},{key:1,name:"订单已确认"}],d=[{key:8,name:"综合联盟"}],f=m.reduce(function(e,t){return e[t.key]=t.name,e},{}),h=p.reduce(function(e,t){return e[t.key]=t.name,e},{}),_={data:function(){return{tableKey:0,list:null,total:null,listLoading:!0,listQuery:{page:1,limit:10,searchJoin:"and",search:"del:0;",searchFields:"del:=;",orderBy:"id",sortedBy:"desc",filter:""},searchQuery:{search:"del:0;",searchFields:"del:=;",field:"uname",keyword:"",status:"",platform:"",uid:null,month:null},fieldOptions:u,statusOptions:p,platformOptions:m,lmOptions:d,mallOptions:[],multipleSelection:[],checkAll:0,isIndeterminate:!1,temp:{},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"创建"},rules:{order_code:[{required:!0,message:"请输入订单号",trigger:"blur"}]}}},filters:{titleFilter:function(e){return e.length>10?e.substr(0,26)+"...":e},statusFilter:function(e){return h[e]},platformFilter:function(e){return f[e]}},created:function(){this.getList(),this.getMalls()},methods:{getList:function(){var e=this;this.listLoading=!0,Object(s.b)(this.listQuery).then(function(t){e.list=t.data.data,e.total=t.data.total,e.listLoading=!1})},getMalls:function(){var e=this;Object(s.c)().then(function(t){e.mallOptions=t.data,e.mallOptions.push({0:"请选择"})})},handleFilter:function(){var e=n()({},this.searchQuery),t=e.search,l=e.searchFields;if(e.field&&e.keyword&&"uname"!=e.field&&(t+=e.field+":"+e.keyword+";",l+=e.field+":=;"),e.uid&&(t+="uid:"+e.uid+";",l+="uid:=;"),e.platform&&(t+="platform:"+e.platform+";",l+="platform:=;"),e.status&&(t+="status:"+e.status+";",l+="status:=;"),e.month){this.listQuery.month=Object(c.f)(Object(c.e)(e.month),"{y}-{m}");var a=this.listQuery.month.split("-"),i=Object(c.d)(a[0],a[1]),r=Object(c.c)(a[0],a[1]);t+="order_time:"+Object(c.e)(i)+","+Object(c.e)(r)+";",l+="order_time:between;"}this.listQuery.search=t,this.listQuery.searchFields=l,this.listQuery.page=1,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length==this.list.length?(this.checkAll=2,this.isIndeterminate=!0):this.multipleSelection.length>0?(this.checkAll=1,this.isIndeterminate=!0):(this.checkAll=0,this.isIndeterminate=!1)},handleDelete:function(){var e=this;if(this.multipleSelection.length<=0)return this.$notify({title:"警告",message:"请选择要删除的条目",type:"warning"}),!1;this.$confirm("此操作将数据移至回收站, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){var t="",l=!0,a=!1,r=void 0;try{for(var n,o=i()(e.multipleSelection);!(l=(n=o.next()).done);l=!0){t+=n.value.id+","}}catch(e){a=!0,r=e}finally{try{!l&&o.return&&o.return()}finally{if(a)throw r}}e.listLoading=!0,Object(s.d)({del:1},t).then(function(t){e.$message({type:"success",message:t.data.message}),e.getList(),e.listLoading=!1})}).catch(function(){})},resetTemp:function(e){this.temp=e||{id:void 0,mall_id:null,lm:8,order_code:"",product_code:"",item_price:0,item_count:0,sales:0,commission:0,fxje:0,jifen:0,uname:"",order_time:"",status:0,user:null}},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},createData:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.order_time=""==e.temp.order_time?null:Object(c.e)(e.temp.order_time),createData(e.temp).then(function(){e.temp.mall_name="",e.temp.platform="",e.list.unshift(e.temp),e.dialogFormVisible=!1,e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}))})}),handleUpdate:function(e){var t=this;this.resetTemp(e),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},updateData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){var l=n()({},e.temp);Object(s.d)(l).then(function(){var t=!0,l=!1,a=void 0;try{for(var r,n=i()(e.list);!(t=(r=n.next()).done);t=!0){var s=r.value;if(s.id===e.temp.id){var o=e.list.indexOf(s);e.list.splice(o,1,e.temp);break}}}catch(e){l=!0,a=e}finally{try{!t&&n.return&&n.return()}finally{if(l)throw a}}e.dialogFormVisible=!1,e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})})}})},getUserId:function(){var e=this;"uname"==this.searchQuery.field&&""!=this.searchQuery.keyword&&Object(o.c)(this.searchQuery.keyword).then(function(t){e.searchQuery.uid=t.data})}}},v={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"app-container",attrs:{"element-loading-text":"Loading"}},[l("div",{staticClass:"filter-container",staticStyle:{"margin-bottom":"10px"}},[l("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"搜索字段"},model:{value:e.searchQuery.field,callback:function(t){e.$set(e.searchQuery,"field",t)},expression:"searchQuery.field"}},e._l(e.fieldOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),e._v("\n      :\n      "),l("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"关键字"},on:{blur:e.getUserId},model:{value:e.searchQuery.keyword,callback:function(t){e.$set(e.searchQuery,"keyword",t)},expression:"searchQuery.keyword"}}),e._v(" "),l("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"会员ID"},model:{value:e.searchQuery.uid,callback:function(t){e.$set(e.searchQuery,"uid",t)},expression:"searchQuery.uid"}}),e._v(" "),l("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"订单状态"},model:{value:e.searchQuery.status,callback:function(t){e.$set(e.searchQuery,"status",t)},expression:"searchQuery.status"}},e._l(e.statusOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),e._v(" "),l("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"来源"},model:{value:e.searchQuery.platform,callback:function(t){e.$set(e.searchQuery,"platform",t)},expression:"searchQuery.platform"}},e._l(e.platformOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),e._v(" "),l("el-date-picker",{attrs:{type:"month",placeholder:"选择月份"},model:{value:e.searchQuery.month,callback:function(t){e.$set(e.searchQuery,"month",t)},expression:"searchQuery.month"}}),e._v(" "),l("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("筛选")]),e._v(" "),l("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v("添加")]),e._v(" "),l("router-link",{attrs:{to:"/trade/mallorder-reycle"}},[l("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-delete"}},[e._v("回收站")])],1)],1),e._v(" "),l("el-table",{ref:"multipleTable",attrs:{size:"small",data:e.list,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"35"}}),e._v(" "),l("el-table-column",{attrs:{label:"订单编号",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",{staticClass:"link-type",on:{click:function(l){e.handleUpdate(t.row)}}},[e._v("\n            "+e._s(t.row.order_code)+"\n          ")])]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"mall_name",label:"商城",width:"80"}}),e._v(" "),l("el-table-column",{attrs:{label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.products,function(t){return l("a",{staticClass:"link-type",attrs:{title:t.name,href:t.url}},[e._v("\n            "+e._s(e._f("titleFilter")(t.name))),l("br")])})}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"product_code",label:"商品ID",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.products,function(t){return l("span",[e._v("\n            "+e._s(t.code)),l("br")])})}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"platform",label:"来源",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("platformFilter")(t.row.platform))+"\n        ")]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"item_count",label:"数量",width:"60"}}),e._v(" "),l("el-table-column",{attrs:{prop:"item_price",label:"单价(元)",width:"70"}}),e._v(" "),l("el-table-column",{attrs:{prop:"sales",label:"总额(元)",width:"70"}}),e._v(" "),l("el-table-column",{attrs:{prop:"commission",label:"佣金",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.commission>0?l("span",[e._v(e._s(t.row.commission))]):l("span",[e._v("--")])]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"fxje",label:"返利",width:"60"}}),e._v(" "),l("el-table-column",{attrs:{prop:"jifen",label:"积分",width:"60"}}),e._v(" "),l("el-table-column",{attrs:{label:"会员",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=t.row.user?l("a",{staticClass:"link-type"},[e._v("\n            "+e._s(t.row.user.ddusername)+"\n          ")]):e._e()]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("statusFilter")(t.row.status))+"\n        ")]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",{staticStyle:{color:"blue"}},[e._v("下单:"+e._s(e._f("parseTime")(t.row.order_time)))]),l("br"),e._v(" "),l("span",{staticStyle:{color:"green"}},[e._v("更新:"+e._s(t.row.update_time))]),l("br"),e._v(" "),"0000-00-00"!=t.row.pay_time?l("span",{staticStyle:{color:"red"}},[e._v("结算:"+e._s(t.row.pay_time))]):l("span",{staticStyle:{color:"red"}},[e._v("结算:--")])]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"operate",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(l){e.handleUpdate(t.row)}}},[e._v("返现")])]}}])})],1),e._v(" "),l("div",{staticClass:"pagination-container"},[0==e.checkAll?l("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection(e.list)}}},[e._v("全选")]):1==e.checkAll?l("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection(e.list)}}},[e._v("反选")]):l("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection()}}},[e._v("取消全选")]),e._v(" "),l("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){e.handleDelete()}}},[e._v("删除")]),e._v(" "),l("el-pagination",{attrs:{background:"","current-page":e.listQuery.page,"page-sizes":[e.listQuery.limit],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),l("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[l("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,size:"small",model:e.temp,"label-position":"left","label-width":"90px"}},["create"==e.dialogStatus?l("div",[l("el-form-item",{attrs:{label:"商城"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.temp.mall_id,callback:function(t){e.$set(e.temp,"mall_id",t)},expression:"temp.mall_id"}},e._l(e.mallOptions,function(e){return l("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"联盟"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.temp.lm,callback:function(t){e.$set(e.temp,"lm",t)},expression:"temp.lm"}},e._l(e.lmOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"订单号",prop:"order_code"}},[l("el-input",{model:{value:e.temp.order_code,callback:function(t){e.$set(e.temp,"order_code",t)},expression:"temp.order_code"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"商品编号",prop:"product_code"}},[l("el-input",{model:{value:e.temp.product_code,callback:function(t){e.$set(e.temp,"product_code",t)},expression:"temp.product_code"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"单价(元)",prop:"item_price"}},[l("el-input",{model:{value:e.temp.item_price,callback:function(t){e.$set(e.temp,"item_price",t)},expression:"temp.item_price"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"数量",prop:"item_count"}},[l("el-input",{model:{value:e.temp.item_count,callback:function(t){e.$set(e.temp,"item_count",t)},expression:"temp.item_count"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"总额(元)",prop:"sales"}},[l("el-input",{model:{value:e.temp.sales,callback:function(t){e.$set(e.temp,"sales",t)},expression:"temp.sales"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"佣金",prop:"commission"}},[l("el-input",{model:{value:e.temp.commission,callback:function(t){e.$set(e.temp,"commission",t)},expression:"temp.commission"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"会员名",prop:"uname"}},[l("el-input",{model:{value:e.temp.uname,callback:function(t){e.$set(e.temp,"uname",t)},expression:"temp.uname"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"下单时间",prop:"order_time"}},[l("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择时间"},model:{value:e.temp.order_time,callback:function(t){e.$set(e.temp,"order_time",t)},expression:"temp.order_time"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"订单状态",prop:"status"}},[l("el-select",{staticClass:"filter-item",model:{value:e.temp.status,callback:function(t){e.$set(e.temp,"status",t)},expression:"temp.status"}},e._l(e.statusOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})}))],1)],1):l("div",[l("el-form-item",{attrs:{label:"商城",prop:"mall_name"}},[e._v(e._s(e.temp.mall_name))]),e._v(" "),l("el-form-item",{attrs:{label:"联盟"}},[e._v("综合联盟")]),e._v(" "),l("el-form-item",{attrs:{label:"订单号",prop:"order_code"}},[e._v(e._s(e.temp.order_code))]),e._v(" "),l("el-form-item",{attrs:{label:"商品编号",prop:"product_code"}},[e._v(e._s(e.temp.product_code))]),e._v(" "),l("el-form-item",{attrs:{label:"数量",prop:"item_count"}},[e._v(e._s(e.temp.item_count))]),e._v(" "),l("el-form-item",{attrs:{label:"单价(元)",prop:"item_price"}},[e._v(e._s(e.temp.item_price))]),e._v(" "),l("el-form-item",{attrs:{label:"总额(元)",prop:"sales"}},[e._v(e._s(e.temp.sales))]),e._v(" "),l("el-form-item",{attrs:{label:"佣金",prop:"commission"}},[l("el-input",{model:{value:e.temp.commission,callback:function(t){e.$set(e.temp,"commission",t)},expression:"temp.commission"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"返利",prop:"fxje"}},[l("el-input",{model:{value:e.temp.fxje,callback:function(t){e.$set(e.temp,"fxje",t)},expression:"temp.fxje"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"积分",prop:"jifen"}},[l("el-input",{model:{value:e.temp.jifen,callback:function(t){e.$set(e.temp,"jifen",t)},expression:"temp.jifen"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"订单状态",prop:"status"}},[l("el-select",{staticClass:"filter-item",model:{value:e.temp.status,callback:function(t){e.$set(e.temp,"status",t)},expression:"temp.status"}},e._l(e.statusOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"会员名",prop:"uname"}},[null==e.temp.user?l("el-input",{model:{value:e.temp.uname,callback:function(t){e.$set(e.temp,"uname",t)},expression:"temp.uname"}}):l("el-input",{model:{value:e.temp.user.ddusername,callback:function(t){e.$set(e.temp.user,"ddusername",t)},expression:"temp.user.ddusername"}})],1)],1)]),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?l("el-button",{attrs:{type:"primary"},on:{click:e.createData}},[e._v("添加")]):l("el-button",{attrs:{type:"primary"},on:{click:e.updateData}},[e._v("更新")])],1)],1)],1)},staticRenderFns:[]};var b=l("VU/8")(_,v,!1,function(e){l("mKg+")},"data-v-a207f7b4",null);t.default=b.exports},ZNHS:function(e,t,l){"use strict";t.b=function(e){return Object(a.a)({url:"/mall_orders",method:"get",params:e})},t.c=function(){return Object(a.a)({url:"/mall_orders/create",method:"get"})},t.d=function(e,t){return Object(a.a)({url:"/mall_orders/"+t,method:"put",params:e})},t.a=function(e){return Object(a.a)({url:"/mall_orders/"+e,method:"delete"})};var a=l("ayk+")},cTCz:function(e,t,l){(e.exports=l("FZ+f")(!1)).push([e.i,"\n.pagination-container[data-v-a207f7b4]{\n  margin-top: 10px;\n}\n.el-pagination[data-v-a207f7b4]{\n  float: right;\n}\n.el-form-item[data-v-a207f7b4]{\n\tmargin-bottom: 10px;\n}\n\n",""])},"mKg+":function(e,t,l){var a=l("cTCz");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);l("rjj0")("414f4792",a,!0)}});