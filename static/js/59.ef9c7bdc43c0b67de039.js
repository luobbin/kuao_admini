webpackJsonp([59],{S6pj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("BO1k"),l=i.n(a),s=i("woOf"),n=i.n(s),o=i("ocd9"),r=i("0xDb"),c=[{key:1,name:"已上线"},{key:2,name:"仅预告"}],d=[{key:"title",name:"商品名称"},{key:"data_id",name:"商品ID"}],p=[{key:0,name:"无"},{key:1,name:"本版置顶"},{key:2,name:"全局置顶"}],u={data:function(){return{tableKey:0,list:null,total:null,listLoading:!0,listQuery:{page:1,limit:15,searchJoin:"and",search:"del:0;",searchFields:"del:=;",orderBy:"top",sortedBy:"desc",filter:""},searchQuery:{search:"del:0;",searchFields:"del:=;",field:"",keyword:"",code:"",leixing:"",cid:"",ddusername:""},leixingOptions:c,goodsOptions:d,bankuaiOptions:null,goodstypeOptions:null,multipleSelection:[],checkAll:0,isIndeterminate:!1,dialogFormVisible:!1,topOptions:p,dialogTemp:{id:void 0,top:"",top_stime:"",top_etime:""},rules:{top:[{required:!0,message:"请选择置顶位置",trigger:"change"}]}}},created:function(){this.getBankuais(),this.getTypes(),this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0,Object(o.f)(this.listQuery).then(function(t){e.list=t.data.data;for(var i=e.list.length-1;i>=0;i--)e.list[i].top_stime=Object(r.f)(e.list[i].top_stime),e.list[i].top_etime=Object(r.f)(e.list[i].top_etime);e.total=t.data.total,e.listLoading=!1})},getBankuais:function(){var e=this;Object(o.e)().then(function(t){e.bankuaiOptions=t.data.data})},getTypes:function(){var e=this;Object(o.g)().then(function(t){e.goodstypeOptions=t.data.data})},handleFilter:function(){var e=n()({},this.searchQuery),t=e.search,i=e.searchFields;if(e.field&&e.keyword&&(t+=e.field+":"+e.keyword+";",i+=e.field+":=;"),e.code&&(t+="code:"+e.code+";",e.searchFields+="code:=;"),e.cid&&(t+="cid:"+e.cid+";",i+="cid:=;"),e.ddusername&&(t+="user.ddusername:"+e.ddusername+";",i+="user.ddusername:=;"),e.leixing){var a=Object(r.e)(new Date);1==e.leixing&&(t+="starttime:"+a+";endtime:"+a+";",i+="starttime:>=;endtime:<;"),2==e.leixing&&(t+="starttime:"+a+";",i+="starttime:>;")}this.listQuery.search=t,this.listQuery.searchFields=i,this.listQuery.page=1,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length==this.list.length?(this.checkAll=2,this.isIndeterminate=!0):this.multipleSelection.length>0?(this.checkAll=1,this.isIndeterminate=!0):(this.checkAll=0,this.isIndeterminate=!1)},handleDelete:function(){var e=this;if(this.multipleSelection.length<=0)return this.$notify({title:"警告",message:"请选择要删除的条目",type:"warning"}),!1;this.$confirm("此操作将数据移至回收站, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){var t="",i=!0,a=!1,s=void 0;try{for(var n,r=l()(e.multipleSelection);!(i=(n=r.next()).done);i=!0){t+=n.value.id+","}}catch(e){a=!0,s=e}finally{try{!i&&r.return&&r.return()}finally{if(a)throw s}}e.listLoading=!0,Object(o.h)({del:1},t).then(function(t){e.$message({type:"success",message:t.data.message}),e.getList(),e.listLoading=!1})}).catch(function(){})},handleShareStatus:function(e,t){var i=this;Object(o.h)({isshare:t},e.id).then(function(a){i.$message({type:"success",message:a.data.message}),e.isshare=t})},handleTop:function(e){var t=this;this.resetTemp(e),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},topData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){var i=n()({},e.dialogTemp);i.top_stime=Object(r.e)(i.top_stime),i.top_etime=Object(r.e)(i.top_etime),Object(o.h)(i,i.id).then(function(){for(var t=e.list.length-1;t>=0;t--)e.list[t].id===e.dialogTemp.id&&(e.list[t].top=i.top,e.list[t].top_stime=Object(r.f)(i.top_stime),e.list[t].top_etime=Object(r.f)(i.top_etime));e.dialogFormVisible=!1,e.$notify({title:"成功",message:"置顶成功",type:"success",duration:2e3})})}})},resetTemp:function(e){this.dialogTemp={id:e.id,top:e.top,top_stime:e.top_stime,top_etime:e.top_etime},e.top>1&&(this.dialogTemp.top=2)},deleteBypast:function(){var e=this;this.$confirm("此操作将已过期的商品彻底删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){e.listLoading=!0,Object(o.b)().then(function(t){e.$message({type:"success",message:t.data.message}),e.getList(),e.listLoading=!1})}).catch(function(){})}}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"app-container",attrs:{"element-loading-text":"Loading"}},[i("div",{staticClass:"filter-container",staticStyle:{"margin-bottom":"10px"}},[e._v("\n    板块:\n    "),i("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"全部"},model:{value:e.searchQuery.code,callback:function(t){e.$set(e.searchQuery,"code",t)},expression:"searchQuery.code"}},e._l(e.bankuaiOptions,function(e){return i("el-option",{key:e.code,attrs:{label:e.title,value:e.code}})})),e._v("\n    类型:\n    "),i("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"全部商品"},model:{value:e.searchQuery.leixing,callback:function(t){e.$set(e.searchQuery,"leixing",t)},expression:"searchQuery.leixing"}},e._l(e.leixingOptions,function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),e._v("\n    分类:\n    "),i("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"全部"},model:{value:e.searchQuery.cid,callback:function(t){e.$set(e.searchQuery,"cid",t)},expression:"searchQuery.cid"}},e._l(e.goodstypeOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),e._v(" "),i("el-select",{staticStyle:{width:"105px"},attrs:{clearable:"",placeholder:"搜索字段"},model:{value:e.searchQuery.field,callback:function(t){e.$set(e.searchQuery,"field",t)},expression:"searchQuery.field"}},e._l(e.goodsOptions,function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),e._v("\n    :\n    "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"关键字"},model:{value:e.searchQuery.keyword,callback:function(t){e.$set(e.searchQuery,"keyword",t)},expression:"searchQuery.keyword"}}),e._v("\n    会员名 :\n    "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"会员名"},model:{value:e.searchQuery.ddusername,callback:function(t){e.$set(e.searchQuery,"ddusername",t)},expression:"searchQuery.ddusername"}}),e._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("筛选")]),e._v(" "),i("router-link",{attrs:{to:"/goods/goods-create"}},[i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-edit"}},[e._v("添加")])],1),e._v(" "),i("router-link",{attrs:{to:"/goods/goodslist-reycle"}},[i("el-button",{attrs:{type:"text"}},[e._v("【回收站】")])],1),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:e.deleteBypast}},[i("font",{attrs:{color:"red"}},[e._v("【删过】")])],1)],1),e._v(" "),i("el-table",{ref:"multipleTable",attrs:{data:e.list,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"35"}}),e._v(" "),i("el-table-column",{attrs:{label:"置顶",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"置顶时间:"+t.row.top_stime+" —— "+t.row.top_etime,placement:"bottom-start"}},[1==t.row.top?i("span",[e._v("本版置顶")]):t.row.top>1?i("span",[e._v("全局置顶")]):i("span",[e._v("--")])])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"title",label:"商品名"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("router-link",{attrs:{to:"/goods/goods-edit/"+t.row.id}},[i("a",{staticClass:"link-type",attrs:{target:"_blank"}},[e._v("\n            "+e._s(t.row.title)+"\n          ")])])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"img",label:"图片",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{attrs:{href:t.row.img,target:"_blank"}},[i("span",{attrs:{slot:"reference"},slot:"reference"},[e._v("查看")])])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"bankuai.title",label:"板块",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"type.title",label:"分类",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{prop:"price",label:"原价",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{prop:"discount_price",label:"促销价",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"user.ddusername",label:"报名人",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"starttime",label:"开始时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(e._f("parseTime")(t.row.starttime,"{y}-{m}-{d} {h}:{i}")))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"endtime",label:"结束时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(e._f("parseTime")(t.row.endtime,"{y}-{m}-{d} {h}:{i}")))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"operate",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("router-link",{attrs:{to:"/goods/goods-edit/"+t.row.id}},[i("el-button",{attrs:{type:"text",size:"small"}},[e._v("修改")])],1),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleTop(t.row)}}},[i("font",{attrs:{color:"orange"}},[e._v("置顶")])],1),e._v(" "),1==t.row.isshare?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){e.handleShareStatus(t.row,"0")}}},[i("font",{attrs:{color:"red"}},[e._v("取消分享")])],1):i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){e.handleShareStatus(t.row,"1")}}},[i("font",{attrs:{color:"green"}},[e._v("分享")])],1)]}}])})],1),e._v(" "),i("div",{staticClass:"pagination-container"},[0==e.checkAll?i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection(e.list)}}},[e._v("全选")]):1==e.checkAll?i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection(e.list)}}},[e._v("反选")]):i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){e.toggleSelection()}}},[e._v("取消全选")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){e.handleDelete()}}},[e._v("删除")]),e._v(" "),i("el-pagination",{attrs:{background:"","current-page":e.listQuery.page,"page-sizes":[e.listQuery.limit],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),i("el-dialog",{attrs:{title:"设置数据置顶位置和时间",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.dialogTemp,"label-position":"left","label-width":"90px"}},[i("el-form-item",{attrs:{label:"置顶位置",prop:"top"}},[i("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},model:{value:e.dialogTemp.top,callback:function(t){e.$set(e.dialogTemp,"top",t)},expression:"dialogTemp.top"}},e._l(e.topOptions,function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"开始时间",prop:"top_stime"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"Please pick a date"},model:{value:e.dialogTemp.top_stime,callback:function(t){e.$set(e.dialogTemp,"top_stime",t)},expression:"dialogTemp.top_stime"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"结束时间",prop:"top_etime"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"Please pick a date"},model:{value:e.dialogTemp.top_etime,callback:function(t){e.$set(e.dialogTemp,"top_etime",t)},expression:"dialogTemp.top_etime"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{on:{click:e.topData}},[e._v("置顶")])],1)],1)],1)},staticRenderFns:[]};var h=i("VU/8")(u,m,!1,function(e){i("ylVe")},"data-v-20899ce9",null);t.default=h.exports},e8as:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.pagination-container[data-v-20899ce9]{\n  margin-top: 10px;\n}\n.el-pagination[data-v-20899ce9]{\n  float: right;\n}\n\n",""])},ylVe:function(e,t,i){var a=i("e8as");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("7b586f18",a,!0)}});